<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/show.css" />
<%- include('../partials/nav') %>

<main>
  <h1><%= title %></h1>
  <section>
    <div>Title: </div>
    <div><%= game.title %></div>
    <div>Release Year: </div>
    <div><%= game.releaseYear %></div>
    <div>Rating: </div>
    <div><%= game.rating %></div>
    <div>Completed? </div>
    <div><%= game.completed ? 'Yea' : 'Nah' %></div>
    <% if (game.owner.equals(user?.profile._id)) { %>
      <a href="/games/<%= game._id %>/edit">
        <button class="btn">Edit this Game</button>
      </a>
    <% } %>
    <h2>Comments</h2>
  <% if (user) { %>
    <h3>Add comment</h3>
    <form action="/games/<%= game._id %>/comments" method="POST">
      <textarea name="content"></textarea><br>
      <button>Save</button>
    </form>
  <% } %>
  <ul>
    <% game.comments?.forEach(comment => { %>
      <li>
        <%= comment.content %> - <%= comment.author.name %>
        <% if (comment.author.equals(user?.profile._id)) { %>
          <form
            action="/games/<%= game._id  %>/comments/<%= comment._id %>?_method=DELETE"
            METHOD="POST"
            class="inline"
          >
            <button class="btn" type="submit">Delete</button>
        </form>
          <a href="/games/<%= game._id %>/comments/<%= comment._id %>/edit">
            <button class="btn">Edit Comment</button>
          </a>
        <% } %>
      </li> 
    <% }) %>
  </ul>
  </section>
</main>
  
<%- include('../partials/footer') %>